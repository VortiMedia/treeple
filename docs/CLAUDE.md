# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**Treeple - Conservation Grid Platform** - A reusable platform for creating interactive conservation experiences. The current implementation features Yellowstone National Park as the MVP, demonstrating how users can explore topographic maps with grid overlays, view parcel details, and symbolically reserve squares for conservation support.

**Platform Vision:** Treeple is designed to support multiple conservation areas (national parks, marine reserves, forests) with area-specific grids, themes, and data. Yellowstone serves as the proof-of-concept.

**Tech Stack:** Next.js 14 (App Router), TypeScript, Tailwind CSS, MapLibre GL JS, Turf.js, shadcn/ui

**Current Phase:** MVP (investor demo) - No backend, payments, or authentication yet

## Essential Commands

### Development
```bash
npm run dev              # Start development server on localhost:3000
npm run build            # Production build
npm run lint             # Run ESLint
npm run format           # Format code with Prettier
```

### Data Generation (Critical for Setup)
```bash
npm run generate-grid    # Generate yellowstone-grid.json (2304 tiles, ~4MB)
npm run seed-tiles       # Create seed-tiles.json with sample statuses
npm run setup            # Run both generators sequentially
```

These scripts create the static JSON data files the app depends on. Always run `npm run setup` after cloning.

### Environment Variables
Required in `.env.local`:
```
NEXT_PUBLIC_MAPTILER_KEY=<your_api_key>  # Get from cloud.maptiler.com
```

## Architecture Overview

### File Organization Pattern
- **Feature-based components**: Components grouped by feature (`components/map/`, `components/tiles/`, `components/layout/`)
- **Static data approach (MVP)**: Grid data and tile statuses stored as JSON in `public/data/`
- **App Router structure**: All pages in `src/app/` using Next.js 14 conventions
- **Import alias**: Use `@/` prefix (e.g., `import { Button } from '@/components/ui/button'`)

### Key Data Flow
1. Grid generated by Turf.js script → `public/data/yellowstone-grid.json`
2. Seed statuses → `public/data/seed-tiles.json`
3. Client loads and merges JSON → Map renders grid as GeoJSON layer
4. User clicks tile → Opens side panel (desktop) or bottom sheet (mobile)
5. MVP: "Reserve" button shows success toast (no persistence)

### Critical Components
- **MapContainer**: Initializes MapLibre instance with MapTiler basemap
- **GridOverlay**: Renders GeoJSON grid as fill + line layers with click/hover handlers
- **SidePanel**: Displays tile details; slides from right (desktop) or bottom (mobile)
- **TileDetails**: Shows coordinates, status badge, price, CTA button

### Grid System
- **Cell size**: 1 km × 1 km (247 acres)
- **Total tiles**: 2,304 covering Yellowstone's bounding box
- **Tile ID format**: `YS-ROW-COL` (e.g., `YS-042-123`)
- **Coordinate system**: WGS84 (lat/lng)
- **Three statuses**: `available` (green), `reserved` (amber), `sold` (gray)

### Design System ("Modern Conservation Glassomorphism")
- **Primary color**: Forest Green (`#4f872b`) for conservation theme
- **Secondary color**: Warm Amber (`#d4a574`) for premium feel
- **Neutrals**: Tailwind Slate scale
- **Glass effect**: `backdrop-blur-xl bg-white/90` with large radius (`rounded-2xl` or `rounded-3xl`)
- **Typography**: Inter (sans-serif), Geist Mono (for IDs/coordinates)
- **Status colors**:
  - Available: `emerald-500` with 20% opacity fill
  - Reserved: `amber-500` with 20% opacity fill
  - Sold: `slate-500` with 30% opacity fill

## Development Guidelines

### Component Patterns
- Use TypeScript interfaces (not PropTypes)
- Memoize expensive map components with `React.memo()`
- Follow responsive-first approach (mobile → desktop)
- Include loading skeletons and error states
- Use shadcn/ui components (`npx shadcn-ui@latest add <component>`)

### Map Integration
- MapLibre GL JS manages the map instance
- Add grid as GeoJSON source with two layers: `grid-fill` (polygons) and `grid-outline` (borders)
- Use MapLibre expressions for dynamic styling based on tile status
- Handle click/hover via map event listeners on `grid-fill` layer
- Remember to clean up layers/sources in `useEffect` cleanup

### Tile State Management
- Use React Context (`AppContext`) for shared state: `selectedTile`, `hoveredTileId`, `isPanelOpen`
- Tile data loaded from static JSON files at build time
- No persistence in MVP - all state is client-side only

### Common Gotchas
- MapTiler API key must be in `.env.local` and prefixed with `NEXT_PUBLIC_`
- Grid JSON files are large (~4MB) - ensure they're generated before starting dev server
- MapLibre CSS must be imported in `globals.css`: `@import 'maplibre-gl/dist/maplibre-gl.css';`
- Mobile uses bottom sheet (shadcn Sheet component) instead of side panel
- Tile IDs are generated based on row/col in grid - they're deterministic but need proper padding (3 digits)

### Testing Checklist
Before committing features:
- [ ] Map loads correctly with grid overlay visible
- [ ] Tile clicks open side panel with correct data
- [ ] Three status colors render distinctly
- [ ] Mobile: bottom sheet works, touch gestures smooth
- [ ] Desktop: side panel slides from right
- [ ] No console errors
- [ ] Lighthouse score > 90

## Phase 2 Preparation (Not Yet Implemented)
Future work includes:
- Supabase backend for real-time tile updates
- Stripe checkout integration
- User authentication (reserved/sold tracking)
- Certificate generation
- Email notifications
- Admin dashboard

For now, focus on MVP polish and demo readiness.
